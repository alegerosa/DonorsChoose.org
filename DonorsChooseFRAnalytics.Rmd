---
title: 'Fundraising Analytics on DonorsChoose.org data'
author: "Alejandra Gerosa"
date: "12/7/2018"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(gridExtra)
library(lubridate)
library(scales)
library(cowplot)

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

## The project

This project analyses [DonorsChoose.org](www.donorschoose.org)'s donation data as released in their mid-2018 [Kaggle competition](https://www.kaggle.com/donorschoose/io). For this writeup, I set out to summarize a few key insights regarding their fundrasing performance between 2013 and 2017. For a more detailed approach, you can dig into the full code of my ongoing exploration of the dataset [here](https://github.com/alegerosa/DonorsChoose.org). 

```{r include=FALSE}
#Loading the data
donations_plus <- read_rds("data/donations_plus.rds")
```
```{r include=FALSE}
#Making the plots and averages
revenue_per_year_plot <- donations_plus %>%
  filter(year(donation_received_date) > 2012 & year(donation_received_date) < 2018) %>%
  ggplot(aes(x = year(donation_received_date), y = donation_amount/1000000, fill = "pink")) +
  geom_col() +
  labs(y = "Total donation value (in millions)") +
  theme(legend.position = "none",
        axis.title.x = element_blank()) +
  scale_y_continuous(labels = dollar_format())
yearly_growth_table <- donations_plus %>%
  filter(year(donation_received_date) > 2012 & year(donation_received_date) < 2018) %>%
  group_by(year = year(donation_received_date)) %>%
  summarize(total = sum(donation_amount)) %>%
  mutate(perc_growth = (total/lag(total))-1)
cagr <- percent(mean(yearly_growth_table$perc_growth, na.rm = TRUE))
perc_growth_per_year_plot <- yearly_growth_table %>%
  ggplot(aes(x = year, y = perc_growth)) +
  geom_line() +
  labs(y = "% growth") +
  theme(axis.line.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank()) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = c(0, .25, .5)) +
  coord_cartesian(ylim = c(0,.5)) +
  geom_text(aes(label = percent(perc_growth)), position = position_dodge(), vjust = -1.5)
perc_growth_per_year_plot

revenue_per_year_per_retained <- donations_plus %>%
  filter(year(donation_received_date) > 2012 & year(donation_received_date) < 2018) %>%
  ggplot(aes(x = year(donation_received_date), y = donation_amount/1000000, fill = retention_status)) +
  geom_col() +
  labs(y = "Total donation value (in millions)", fill = "Donor gave in the year prior?") +
  theme(legend.position = "bottom",
        axis.title.x = element_blank(),
        legend.title = element_blank()) +
  scale_y_continuous(labels = dollar_format())
yearly_proper_retained_table <- donations_plus %>%
  filter(year(donation_received_date) > 2012 & year(donation_received_date) < 2018) %>%
  group_by(year = year(donation_received_date), donor_gave_last_year) %>%
  summarize(total = sum(donation_amount)) %>%
  spread(donor_gave_last_year, total) %>%
  mutate(total = sum(c(`FALSE`,`TRUE`), na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(perc_retained = `TRUE`/lag(total))
avg_retention <- percent(mean(yearly_proper_retained_table$perc_retained, na.rm = TRUE))
perc_proper_retained_per_year_plot <- yearly_proper_retained_table %>%
  ggplot(aes(x = year, y = perc_retained)) +
  geom_line() +
  labs(y = "Value Retention") +
  theme(axis.line.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank()) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = c(.3, .45, .6)) +
  coord_cartesian(ylim = c(.3,.6)) +
  geom_text(aes(label = percent(perc_retained)), position = position_dodge(), vjust = -1.5)

```

## Key Insights
* Donations are growing by an average of `r cagr` every year, and growth has been slowing down.
* Most donors have given only once, showing uncaptured opportunities for long term value.
* Top 10 states account for 56% of donations, and top 3 states account for ~30%.
* December, August and September account for ~35% of donations.

## On average, donations are growing by `r cagr` each year

```{r}
#Calling growth plots
plot_grid(perc_growth_per_year_plot, revenue_per_year_plot, align = "v", nrow = 2, rel_heights = c(1/4, 3/4))
            

```

The great news is that the total amount raised for teacher's projects is growing every year at a rate of almost 25% on average. This is considerably above the overall increase in charitable giving by individuals, which [Giving USA](https://givingusa.org/tag/giving-usa-2018/) identified as 5.2% in 2017.

The less positive news is that growth is slowing down, with only 16% in 2017. How worrisome this is, if at all, depends on the expectation and intention of the organization. The key question here is: Was the tapering off a decision or is it a surprise? If the latter, can we pinpoint what didn't work as expected?

In any case, if the goal is to maintain growth at around 25%, further action will be needed.

## Most donors have given only give once

If I want to assess the health of an organization's fundraising pipeline there's a question that I care about much more than how fast we are growing. That is: Are donors coming back?

#### Value Retention: About half of a year's donation value doesn't come back the following year

```{r}
#Calling value retention plots
plot_grid(perc_proper_retained_per_year_plot, revenue_per_year_per_retained, align = "v", nrow = 2, rel_heights = c(1/4, 3/4))
```

The organization's value retention rate in this period hovered around 45-50%, which is squarely in line with industry benchmarks: average retention for organizations included in the Association of Fundraising Professionals (AFP)'s [Fundraising Effectiveness Project](bit.ly/GIG_FEP_Reports) was 48%. This means that about half of donations in any given year are lost the next year, and have to be earned from newly acquired (or recovered) donors.

#### Donor Retention: Less than 1 out of 5 of a year's donors give again the next year

```{r}
#Creating and calling donor retention plots
revenue_per_year_per_retained_donors <- donations_plus %>%
  filter(year(donation_received_date) > 2012 & year(donation_received_date) < 2018) %>%
  group_by(year = year(donation_received_date), retention_status) %>%
  summarize(donors = n_distinct(donor_id)) %>%
  ggplot(aes(x = year, y = donors, fill = retention_status)) +
  geom_col() +
  labs(y = "Number of donors", fill = "Donor gave in the year prior?") +
  theme(legend.position = "bottom",
        axis.title.x = element_blank(),
        legend.title = element_blank()) +
  scale_y_continuous(label = scales::comma)
yearly_proper_retained_donors_table <- donations_plus %>%
  filter(year(donation_received_date) > 2012 & year(donation_received_date) < 2018) %>%
  group_by(year = year(donation_received_date), donor_gave_last_year) %>%
  summarize(total = n_distinct(donor_id)) %>%
  spread(donor_gave_last_year, total) %>%
  mutate(total = sum(c(`FALSE`,`TRUE`), na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(perc_retained = `TRUE`/lag(total))
avg_donor_retention <- percent(mean(yearly_proper_retained_donors_table$perc_retained, na.rm = TRUE))
perc_proper_retained_donors_per_year_plot <- yearly_proper_retained_donors_table %>%
  ggplot(aes(x = year, y = perc_retained)) +
  geom_line() +
  labs(y = "Donor Retention") +
  theme(axis.line.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank()) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  coord_cartesian(ylim = c(.1,.3)) +
  geom_text(aes(label = percent(perc_retained)), position = position_dodge(), vjust = -1.5)
plot_grid(perc_proper_retained_donors_per_year_plot, revenue_per_year_per_retained_donors, align = "v", nrow = 2, rel_heights = c(1/4, 3/4))
```

So far we've looked at the donation values, but if we look at the numbers at the donor level, it gets even more interesting: donor retention is around 19.5%-17.9%, with an average of `r avg_donor_retention`. Not only is this far below the 45.5 % average for organizations included in AFP reports, but it's also trending downwards.

Understanding and acting upon this metric would be very worth management's time. In a sense, this is a remarkable opportunity: thousands of donors that could come back given the right engagement efforts, likely requiring less investment than acquiring a whole new donor would.

## Timing

Seguimos aca a ver que pasa